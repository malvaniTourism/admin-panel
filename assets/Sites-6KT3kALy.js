import{P as D,R as le,r,j as e,C as ge}from"./index-CJkMoobl.js";import{a as R}from"./apiService-C4XhZ6hP.js";import{S as ue,D as B}from"./DropdownSearch-CHibabL8.js";import{F as K}from"./endpoints-BRoPVXl4.js";import{C as xe,a as w}from"./CRow-B6rZDrMH.js";import{C as X,a as Y}from"./CCardBody-e2dIRu1F.js";import{C as je}from"./CCardHeader-BfPMArJP.js";import{C as U}from"./CForm-DNa9OEyG.js";import{C as i}from"./CFormLabel-DlAN-kIg.js";import{C as l}from"./CFormInput-ClM7_3wd.js";import{a as y}from"./index.es-g-IK5C-f.js";import{C as Ce}from"./CAlert-BAvv5-A4.js";import{C as fe,a as _e,b as Z,c,d as ye,e as d}from"./CTable-XiHs_9Db.js";import{C as G}from"./CImage-TAiWPKi0.js";import{C as Se,a as be}from"./CPaginationItem-CCOJgcm4.js";import{C as ee,a as ae,b as se,c as ne,d as te}from"./CModalTitle-CLuPqPFR.js";import{C as ie}from"./CFormSelect-B_hyZ_Cv.js";import"./CFormControlWrapper-hsy96VfT.js";import"./CFormControlValidation-BNr3UDaa.js";import"./CCloseButton-BZUQHCfc.js";import"./DefaultLayout-Cyq9oOPq.js";import"./cil-user-Dlmw-Gem.js";const re=({onChange:u,endpoint:S,label:m,filter:x,valueKey:E="id"})=>{const[H,Q]=r.useState([]),[$,k]=r.useState([]),[g,I]=r.useState(!1),[P,z]=r.useState(null),[f,N]=r.useState(1),[T,J]=r.useState(1),[q,s]=r.useState("");r.useEffect(()=>{p(f,S,q,x)},[f,S,q,x]);const p=async(h,v,F,M)=>{const _=new FormData;F&&_.append("search",F),_.append("apitype","dropdown"),M.forEach(o=>{Object.entries(o).forEach(([C,L])=>{_.append(C,L)})}),I(!0);try{const o=await R("POST",`${v}?page=${h}`,_),L=(o.data.data||[]).map(O=>({value:O[E],label:O.name}));k(L),J(o.data.last_page||1)}catch(o){console.error("Error fetching options:",o),z(o.message)}finally{I(!1)}},j=h=>{Q(h),u&&u(h?h.map(v=>v.value):[])},b=((h,v)=>{let F;return function(){const M=this,_=arguments;clearTimeout(F),F=setTimeout(()=>h.apply(M,_),v)}})(h=>{h.length>=2&&(s(h),N(1))},500);return e.jsxs("div",{className:"example",children:[e.jsx(ue,{value:H,onChange:j,onInputChange:b,options:$,isLoading:g,placeholder:m,isMulti:!0,isClearable:!0}),P&&e.jsx("div",{className:"error",children:P})]})};re.propTypes={onChange:D.func,endpoint:D.string.isRequired,label:D.string.isRequired,filter:D.array.isRequired,valueKey:D.string};const oe=le.memo(re),ce=({text:u,maxLength:S=100})=>{const[m,x]=r.useState(!1),E=()=>{x(!m)};return u.length<=S?e.jsx("span",{children:u}):e.jsxs("span",{children:[m?u:`${u.substring(0,S)}...`,e.jsx("button",{onClick:E,className:"btn btn-link",children:m?"See Less":"See More"})]})};ce.propTypes={text:D.string.isRequired,maxLength:D.number};const ve=le.memo(ce),Ge=()=>{const[u,S]=r.useState([]),[m,x]=r.useState(1),[E,H]=r.useState([]),[Q,$]=r.useState(1),[k,g]=r.useState(!1),[I,P]=r.useState(!1),[z,f]=r.useState(!1),[N,T]=r.useState(!1),[J,q]=r.useState({}),[s,p]=r.useState({id:"",name:"",parent_id:"",category:"",categories:"",user_id:"",bus_stop_type:"",tag_line:"",description:"",domain_name:"",logo:"",icon:"",image:"",status:"",latitude:"",longitude:"",pin_code:"",speciality:"{}",rules:"{}",social_media:"{}",meta_data:"{}"});r.useEffect(()=>{N&&q({...s}),b(m)},[m,N]);const j=a=>{P(a)},V=()=>{P(null)},b=async a=>{localStorage.getItem("token");const t=new FormData;t.append("apitype","list"),t.append("global",1),s.category&&t.append("category",s.category),s.parent_id&&t.append("parent_id",s.parent_id),g(!0);try{const n=await R("POST",`sites?page=${a}`,t);if(n.success===!1){j((n==null?void 0:n.message)||"Something went wrong");return}if(n&&n.data)S(n.data.data||[]),H(n.data.links||[]),$(n.data.last_page||1);else throw new Error("Invalid data structure")}catch(n){console.error("Error fetching sites:",n)}finally{g(!1)}},h=a=>{p(t=>({...t,parent_id:a,category:""}))},v=a=>{p({...s,category:a})},F=()=>{!s.parent_id&&!s.category&&p(a=>({...a,category:"city"})),x(1),b(1)},M=a=>{x(a==="&laquo; Previous"?m-1:a==="Next &raquo;"?m+1:parseInt(a))},_=a=>a.replace("&laquo;","").replace("&raquo;",""),o=a=>{const{name:t,value:n}=a.target;p(A=>({...A,[t]:n}))},C=a=>{const{name:t,files:n}=a.target;p({...s,[t]:n[0]})},L=async()=>{const a=new FormData;Object.keys(s).forEach(t=>{console.log(t,s[t])}),s.id&&a.append("id",s.id),s.name&&a.append("name",s.name),s.parent_id&&a.append("parent_id",s.parent_id),s.user_id&&a.append("user_id",s.user_id),s.categories&&s.categories.length>0&&a.append("categories",JSON.stringify(s.categories)),s.bus_stop_type&&a.append("bus_stop_type",s.bus_stop_type),s.tag_line&&a.append("tag_line",s.tag_line),s.description&&a.append("description",s.description),s.domain_name&&a.append("domain_name",s.domain_name),s.logo&&a.append("logo",s.logo),s.icon&&a.append("icon",s.icon),s.image&&a.append("image",s.image),a.append("status",s.status?"1":"0"),s.latitude&&a.append("latitude",s.latitude),s.longitude&&a.append("longitude",s.longitude),s.pin_code&&a.append("pin_code",s.pin_code),s.speciality&&a.append("speciality",s.speciality),s.rules&&a.append("rules",s.rules),s.social_media&&a.append("social_media",s.social_media),s.meta_data&&a.append("meta_data",s.meta_data),g(!0);try{const t=await R("POST","addSite",a);if(!t.success){const n=Object.values(t.message).flat().join(", ");j(n);return}f(!1),b(m)}catch(t){console.error("Error adding site:",t),j(t.message)}finally{g(!1)}},O=a=>{p({...s,parent_id:a})},W=a=>{p(t=>({...t,categories:a}))},de=async a=>{const t=new FormData;Object.keys(s).forEach(n=>{console.log(n,s[n])}),s.id&&t.append("id",s.id),g(!0);try{const n=await R("POST","deleteSite",{id:a});if(!n.success){const A=Object.values(n.message).flat().join(", ");j(A);return}p(s),b(m)}catch(n){console.error("Error deleting site:",n),j(n.message)}finally{g(!1)}},me=a=>{p({id:a.id,name:a.name,description:a.description,icon:null,meta_data:a.meta_data}),T(!0)},pe=async()=>{const a=new FormData,t=he();s.id&&a.append("id",s.id),Object.keys(t).forEach(n=>{n==="categories"&&Array.isArray(t[n])?a.append("categories",JSON.stringify(t[n])):n==="status"?a.append(n,t[n]?"1":"0"):a.append(n,t[n])}),g(!0);try{const n=await R("POST","updateSite",a);if(!n.success){const A=Object.values(n.message).flat().join(", ");j(A);return}T(!1),b(m)}catch(n){console.error("Error updating site:",n),j(n.message)}finally{g(!1)}},he=()=>{const a={};return Object.keys(s).forEach(t=>{s[t]!==J[t]&&(a[t]=s[t])}),a};return e.jsxs(xe,{children:[e.jsx(w,{xs:12,children:e.jsxs(X,{className:"mb-4",children:[e.jsx(je,{children:e.jsxs(w,{xs:12,children:[e.jsx(X,{className:"mb-4",children:e.jsx(Y,{children:e.jsxs(U,{className:"row gx-3 gy-2 align-items-center",onSubmit:a=>{a.preventDefault(),F()},children:[e.jsxs(w,{sm:3,children:[e.jsx(i,{className:"visually-hidden",htmlFor:"specificSizeInputName",children:"Name"}),e.jsx(l,{id:"specificSizeInputName",placeholder:"Jane Doe",value:s.name,onChange:a=>p({...s,name:a.target.value})})]}),e.jsx(w,{sm:3,children:e.jsx(B,{onChange:h,endpoint:"sites",label:"Cities",filter:[{category:"city"}]})}),e.jsx(w,{sm:3,children:e.jsx(B,{onChange:v,endpoint:"listcategories",label:"Categories",filter:[{global:1}],valueKey:"code"})}),e.jsx(w,{xs:"auto",children:e.jsx(y,{color:"primary",type:"submit",children:"Search"})}),e.jsx(w,{xs:"auto",children:e.jsx(y,{color:"primary",onClick:()=>f(!0),children:"Add"})})]})})}),I&&e.jsx(Ce,{color:"danger",onClose:V,dismissible:!0,children:I})]})}),e.jsx(Y,{children:k?e.jsx(ge,{color:"primary"}):e.jsxs(e.Fragment,{children:[e.jsxs(fe,{children:[e.jsx(_e,{children:e.jsxs(Z,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Category"}),e.jsx(c,{scope:"col",children:"Stop Type"}),e.jsx(c,{scope:"col",children:"Tag Line"}),e.jsx(c,{scope:"col",children:"Description"}),e.jsx(c,{scope:"col",children:"Icon"}),e.jsx(c,{scope:"col",children:"Logo"}),e.jsx(c,{scope:"col",children:"Image"}),e.jsx(c,{scope:"col",children:"Domain Name"}),e.jsx(c,{scope:"col",children:"Status"}),e.jsx(c,{scope:"col",children:"Is Hot Place"}),e.jsx(c,{scope:"col",children:"Latitude"}),e.jsx(c,{scope:"col",children:"Longitude"}),e.jsx(c,{scope:"col",children:"Actions"})]})}),e.jsx(ye,{children:u.map((a,t)=>e.jsxs(Z,{children:[e.jsx(c,{scope:"row",children:t+1}),e.jsx(d,{children:a.name}),e.jsx(d,{children:a.categories&&a.categories.length>0?a.categories.map(n=>e.jsx("span",{style:{marginRight:"5px",display:"inline-block",whiteSpace:"nowrap"},children:" #"+n.name},n.id)):e.jsx("span",{children:"No Categories"})}),e.jsx(d,{children:a.bus_stop_type}),e.jsx(d,{children:a.tag_line}),e.jsx(d,{children:e.jsx(ve,{text:a.description})}),e.jsx(d,{children:a.icon?e.jsx(G,{src:K+a.icon,alt:a.icon,width:"50"}):"No Image"})," ",e.jsx(d,{children:a.logo?e.jsx(G,{src:K+a.logo,alt:a.logo,width:"50"}):"No Image"})," ",e.jsx(d,{children:a.image?e.jsx(G,{src:K+a.image,alt:a.image,width:"50"}):"No Image"}),e.jsx(d,{children:a.domain_name}),e.jsx(d,{children:a.status}),e.jsx(d,{children:a.is_hot_place}),e.jsx(d,{children:a.latitude}),e.jsx(d,{children:a.longitude}),e.jsxs(d,{children:[e.jsx(y,{color:"warning",size:"sm",onClick:()=>me(a),children:"Edit"})," ",e.jsx(y,{color:"danger",size:"sm",onClick:()=>de(a.id),children:"Delete"})]})]},a.id))})]}),e.jsx(Se,{children:E.map((a,t)=>e.jsx(be,{active:a.active,onClick:()=>M(a.label),disabled:!a.url,children:_(a.label)},t))})]})})]})}),e.jsxs(ee,{visible:z,onClose:()=>f(!1),children:[e.jsx(ae,{onClose:()=>f(!1),children:e.jsx(se,{children:"Add Site"})}),e.jsx(ne,{children:e.jsxs(U,{children:[e.jsx(i,{htmlFor:"name",children:"Name"}),e.jsx(l,{id:"name",name:"name",value:s.name,onChange:o}),e.jsx(i,{htmlFor:"name",children:"Site"}),e.jsx(B,{onChange:O,endpoint:"sites",label:"Cities",filter:[{}]}),e.jsx(i,{htmlFor:"name",children:"Categories"}),e.jsx(oe,{onChange:W,endpoint:"listcategories",label:"Categories",filter:[{global:1}]}),e.jsx(i,{htmlFor:"bus_stop_type",children:"Bus Stop Type"}),e.jsx(l,{id:"bus_stop_type",name:"bus_stop_type",value:s.bus_stop_type,onChange:o}),e.jsx(i,{htmlFor:"tag_line",children:"Tag Line"}),e.jsx(l,{id:"tag_line",name:"tag_line",value:s.tag_line,onChange:o}),e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(l,{id:"description",name:"description",value:s.description,onChange:o}),e.jsx(i,{htmlFor:"domain_name",children:"Domain Name"}),e.jsx(l,{id:"domain_name",name:"domain_name",value:s.domain_name,onChange:o}),e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(ie,{id:"status",name:"status",value:s.status,onChange:o,children:[e.jsx("option",{value:!0,children:"Active"}),e.jsx("option",{value:!1,children:"Inactive"})]}),e.jsx(i,{htmlFor:"is_hot_place",children:"Is Hot Place"}),e.jsx(l,{id:"is_hot_place",name:"is_hot_place",value:s.is_hot_place,onChange:o}),e.jsx(i,{htmlFor:"latitude",children:"Latitude"}),e.jsx(l,{id:"latitude",name:"latitude",value:s.latitude,onChange:o}),e.jsx(i,{htmlFor:"longitude",children:"Longitude"}),e.jsx(l,{id:"longitude",name:"longitude",value:s.longitude,onChange:o}),e.jsx(i,{htmlFor:"pin_code",children:"Pin Code"}),e.jsx(l,{id:"pin_code",name:"pin_code",value:s.pin_code,onChange:o}),e.jsx(i,{htmlFor:"speciality",children:"Speciality"}),e.jsx(l,{id:"speciality",name:"speciality",value:s.speciality,onChange:o}),e.jsx(i,{htmlFor:"rules",children:"Rules"}),e.jsx(l,{id:"rules",name:"rules",value:s.rules,onChange:o}),e.jsx(i,{htmlFor:"social_media",children:"Social Media"}),e.jsx(l,{id:"social_media",name:"social_media",value:s.social_media,onChange:o}),e.jsx(i,{htmlFor:"meta_data",children:"Meta Data"}),e.jsx(l,{id:"meta_data",name:"meta_data",value:s.meta_data,onChange:o}),e.jsx(i,{htmlFor:"logo",children:"Logo"}),e.jsx(l,{type:"file",id:"logo",name:"logo",onChange:C}),e.jsx(i,{htmlFor:"icon",children:"Icon"}),e.jsx(l,{type:"file",id:"icon",name:"icon",onChange:C}),e.jsx(i,{htmlFor:"image",children:"Image"}),e.jsx(l,{type:"file",id:"image",name:"image",onChange:C})]})}),e.jsxs(te,{children:[e.jsx(y,{color:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(y,{color:"primary",onClick:L,children:"Save changes"})]})]}),e.jsxs(ee,{visible:N,onClose:()=>T(!1),children:[e.jsx(ae,{onClose:()=>T(!1),children:e.jsx(se,{children:"Edit Site"})}),e.jsx(ne,{children:e.jsxs(U,{children:[e.jsx(i,{htmlFor:"name",children:"Name"}),e.jsx(l,{id:"name",name:"name",value:s.name,onChange:o}),e.jsx(i,{htmlFor:"site",children:"Site"}),e.jsx(B,{onChange:O,endpoint:"sites",label:"Cities",filter:[{}]}),e.jsx(i,{htmlFor:"categories",children:"Categories"}),e.jsx(oe,{onChange:W,endpoint:"listcategories",label:"Categories",filter:[{global:1}]}),e.jsx(i,{htmlFor:"bus_stop_type",children:"Bus Stop Type"}),e.jsx(l,{id:"bus_stop_type",name:"bus_stop_type",value:s.bus_stop_type,onChange:o}),e.jsx(i,{htmlFor:"tag_line",children:"Tag Line"}),e.jsx(l,{id:"tag_line",name:"tag_line",value:s.tag_line,onChange:o}),e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(l,{id:"description",name:"description",value:s.description,onChange:o}),e.jsx(i,{htmlFor:"domain_name",children:"Domain Name"}),e.jsx(l,{id:"domain_name",name:"domain_name",value:s.domain_name,onChange:o}),e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(ie,{id:"status",name:"status",value:s.status,onChange:o,children:[e.jsx("option",{value:!0,children:"Active"}),e.jsx("option",{value:!1,children:"Inactive"})]}),e.jsx(i,{htmlFor:"is_hot_place",children:"Is Hot Place"}),e.jsx(l,{id:"is_hot_place",name:"is_hot_place",value:s.is_hot_place,onChange:o}),e.jsx(i,{htmlFor:"latitude",children:"Latitude"}),e.jsx(l,{id:"latitude",name:"latitude",value:s.latitude,onChange:o}),e.jsx(i,{htmlFor:"longitude",children:"Longitude"}),e.jsx(l,{id:"longitude",name:"longitude",value:s.longitude,onChange:o}),e.jsx(i,{htmlFor:"pin_code",children:"Pin Code"}),e.jsx(l,{id:"pin_code",name:"pin_code",value:s.pin_code,onChange:o}),e.jsx(i,{htmlFor:"speciality",children:"Speciality"}),e.jsx(l,{id:"speciality",name:"speciality",value:s.speciality,onChange:o}),e.jsx(i,{htmlFor:"rules",children:"Rules"}),e.jsx(l,{id:"rules",name:"rules",value:s.rules,onChange:o}),e.jsx(i,{htmlFor:"social_media",children:"Social Media"}),e.jsx(l,{id:"social_media",name:"social_media",value:s.social_media,onChange:o}),e.jsx(i,{htmlFor:"meta_data",children:"Meta Data"}),e.jsx(l,{id:"meta_data",name:"meta_data",value:s.meta_data,onChange:o}),e.jsx(i,{htmlFor:"logo",children:"Logo"}),e.jsx(l,{type:"file",id:"logo",name:"logo",onChange:C}),e.jsx(i,{htmlFor:"icon",children:"Icon"}),e.jsx(l,{type:"file",id:"icon",name:"icon",onChange:C}),e.jsx(i,{htmlFor:"image",children:"Image"}),e.jsx(l,{type:"file",id:"image",name:"image",onChange:C})]})}),e.jsxs(te,{children:[e.jsx(y,{color:"secondary",onClick:()=>T(!1),children:"Close"}),e.jsx(y,{color:"primary",onClick:pe,children:"Save Changes"})]})]})]})};export{Ge as default};
