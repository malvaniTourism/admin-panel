import{P as M,R as me,r,j as e,C as pe}from"./index-OLAyHMz1.js";import{a as L}from"./apiService-BO8Zjuly.js";import{S as he,D as k}from"./DropdownSearch-BapdSwQy.js";import{C as ge,a as b}from"./CRow-BwpmZOtT.js";import{C as W,a as X}from"./CCardBody-D_h7H6Am.js";import{C as ue}from"./CCardHeader-CXCJfUXR.js";import{C as K}from"./CForm-CS6RISJG.js";import{C as i}from"./CFormLabel-BQoNNGnS.js";import{C as l}from"./CFormInput-VYgYkESb.js";import{a as f}from"./index.es-DiKRPHk4.js";import{C as je}from"./CAlert-CvmOG1OV.js";import{C as xe,a as Ce,b as Y,c,d as fe,e as d}from"./CTable-I_DDEoml.js";import{C as G}from"./CImage-DWyCqwxu.js";import{C as _e,a as ye}from"./CPaginationItem-CwiWpbdd.js";import{C as Z,a as ee,b as ae,c as ne,d as se}from"./CModalTitle-s_uSAXGX.js";import{C as te}from"./CFormSelect-CP8dGAGs.js";import"./CFormControlWrapper-DTrC4JU9.js";import"./CFormControlValidation-Cr82iOp3.js";import"./CCloseButton-rceQrauj.js";import"./DefaultLayout-CVqlaZsG.js";import"./cil-user-Dlmw-Gem.js";const oe=({onChange:O,endpoint:A,label:g,filter:_,valueKey:q="id"})=>{const[H,Q]=r.useState([]),[B,$]=r.useState([]),[h,w]=r.useState(!1),[D,z]=r.useState(null),[x,T]=r.useState(1),[F,J]=r.useState(1),[R,n]=r.useState("");r.useEffect(()=>{m(x,A,R,_)},[x,A,R,_]);const m=async(p,S,v,I)=>{const C=new FormData;v&&C.append("search",v),C.append("apitype","dropdown"),I.forEach(o=>{Object.entries(o).forEach(([j,P])=>{C.append(j,P)})}),w(!0);try{const o=await L("POST",`${S}?page=${p}`,C),P=(o.data.data||[]).map(E=>({value:E[q],label:E.name}));$(P),J(o.data.last_page||1)}catch(o){console.error("Error fetching options:",o),z(o.message)}finally{w(!1)}},u=p=>{Q(p),O&&O(p?p.map(S=>S.value):[])},y=((p,S)=>{let v;return function(){const I=this,C=arguments;clearTimeout(v),v=setTimeout(()=>p.apply(I,C),S)}})(p=>{p.length>=2&&(n(p),T(1))},500);return e.jsxs("div",{className:"example",children:[e.jsx(he,{value:H,onChange:u,onInputChange:y,options:B,isLoading:h,placeholder:g,isMulti:!0,isClearable:!0}),D&&e.jsx("div",{className:"error",children:D})]})};oe.propTypes={onChange:M.func,endpoint:M.string.isRequired,label:M.string.isRequired,filter:M.array.isRequired,valueKey:M.string};const ie=me.memo(oe),ze=()=>{const[O,A]=r.useState([]),[g,_]=r.useState(1),[q,H]=r.useState([]),[Q,B]=r.useState(1),[$,h]=r.useState(!1),[w,D]=r.useState(!1),[z,x]=r.useState(!1),[T,F]=r.useState(!1),[J,R]=r.useState({}),[n,m]=r.useState({id:"",name:"",parent_id:"",category:"",categories:"",user_id:"",bus_stop_type:"",tag_line:"",description:"",domain_name:"",logo:"",icon:"",image:"",status:"",latitude:"",longitude:"",pin_code:"",speciality:"{}",rules:"{}",social_media:"{}",meta_data:"{}"});r.useEffect(()=>{T&&R({...n}),y(g)},[g,T]);const u=a=>{D(a)},U=()=>{D(null)},y=async a=>{localStorage.getItem("token");const t=new FormData;t.append("apitype","list"),t.append("global",1),n.category&&t.append("category",n.category),n.parent_id&&t.append("parent_id",n.parent_id),h(!0);try{const s=await L("POST",`sites?page=${a}`,t);if(s.success===!1){u((s==null?void 0:s.message)||"Something went wrong");return}if(s&&s.data)A(s.data.data||[]),H(s.data.links||[]),B(s.data.last_page||1);else throw new Error("Invalid data structure")}catch(s){console.error("Error fetching sites:",s)}finally{h(!1)}},p=a=>{m(t=>({...t,parent_id:a,category:""}))},S=a=>{m({...n,category:a})},v=()=>{!n.parent_id&&!n.category&&m(a=>({...a,category:"city"})),_(1),y(1)},I=a=>{_(a==="&laquo; Previous"?g-1:a==="Next &raquo;"?g+1:parseInt(a))},C=a=>a.replace("&laquo;","").replace("&raquo;",""),o=a=>{const{name:t,value:s}=a.target;m(N=>({...N,[t]:s}))},j=a=>{const{name:t,files:s}=a.target;m({...n,[t]:s[0]})},P=async()=>{const a=new FormData;Object.keys(n).forEach(t=>{console.log(t,n[t])}),n.id&&a.append("id",n.id),n.name&&a.append("name",n.name),n.parent_id&&a.append("parent_id",n.parent_id),n.user_id&&a.append("user_id",n.user_id),n.categories&&n.categories.length>0&&a.append("categories",JSON.stringify(n.categories)),n.bus_stop_type&&a.append("bus_stop_type",n.bus_stop_type),n.tag_line&&a.append("tag_line",n.tag_line),n.description&&a.append("description",n.description),n.domain_name&&a.append("domain_name",n.domain_name),n.logo&&a.append("logo",n.logo),n.icon&&a.append("icon",n.icon),n.image&&a.append("image",n.image),a.append("status",n.status?"1":"0"),n.latitude&&a.append("latitude",n.latitude),n.longitude&&a.append("longitude",n.longitude),n.pin_code&&a.append("pin_code",n.pin_code),n.speciality&&a.append("speciality",n.speciality),n.rules&&a.append("rules",n.rules),n.social_media&&a.append("social_media",n.social_media),n.meta_data&&a.append("meta_data",n.meta_data),h(!0);try{const t=await L("POST","addSite",a);if(!t.success){const s=Object.values(t.message).flat().join(", ");u(s);return}x(!1),y(g)}catch(t){console.error("Error adding site:",t),u(t.message)}finally{h(!1)}},E=a=>{m({...n,parent_id:a})},V=a=>{m(t=>({...t,categories:a}))},le=async a=>{const t=new FormData;Object.keys(n).forEach(s=>{console.log(s,n[s])}),n.id&&t.append("id",n.id),h(!0);try{const s=await L("POST","deleteSite",{id:a});if(!s.success){const N=Object.values(s.message).flat().join(", ");u(N);return}m(n),y(g)}catch(s){console.error("Error deleting site:",s),u(s.message)}finally{h(!1)}},re=a=>{m({id:a.id,name:a.name,description:a.description,icon:null,meta_data:a.meta_data}),F(!0)},ce=async()=>{const a=new FormData,t=de();n.id&&a.append("id",n.id),Object.keys(t).forEach(s=>{s==="categories"&&Array.isArray(t[s])?a.append("categories",JSON.stringify(t[s])):s==="status"?a.append(s,t[s]?"1":"0"):a.append(s,t[s])}),h(!0);try{const s=await L("POST","updateSite",a);if(!s.success){const N=Object.values(s.message).flat().join(", ");u(N);return}F(!1),y(g)}catch(s){console.error("Error updating site:",s),u(s.message)}finally{h(!1)}},de=()=>{const a={};return Object.keys(n).forEach(t=>{n[t]!==J[t]&&(a[t]=n[t])}),a};return e.jsxs(ge,{children:[e.jsx(b,{xs:12,children:e.jsxs(W,{className:"mb-4",children:[e.jsx(ue,{children:e.jsxs(b,{xs:12,children:[e.jsx(W,{className:"mb-4",children:e.jsx(X,{children:e.jsxs(K,{className:"row gx-3 gy-2 align-items-center",onSubmit:a=>{a.preventDefault(),v()},children:[e.jsxs(b,{sm:3,children:[e.jsx(i,{className:"visually-hidden",htmlFor:"specificSizeInputName",children:"Name"}),e.jsx(l,{id:"specificSizeInputName",placeholder:"Jane Doe",value:n.name,onChange:a=>m({...n,name:a.target.value})})]}),e.jsx(b,{sm:3,children:e.jsx(k,{onChange:p,endpoint:"sites",label:"Cities",filter:[{category:"city"}]})}),e.jsx(b,{sm:3,children:e.jsx(k,{onChange:S,endpoint:"listcategories",label:"Categories",filter:[{global:1}],valueKey:"code"})}),e.jsx(b,{xs:"auto",children:e.jsx(f,{color:"primary",type:"submit",children:"Search"})}),e.jsx(b,{xs:"auto",children:e.jsx(f,{color:"primary",onClick:()=>x(!0),children:"Add"})})]})})}),w&&e.jsx(je,{color:"danger",onClose:U,dismissible:!0,children:w})]})}),e.jsx(X,{children:$?e.jsx(pe,{color:"primary"}):e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsx(Ce,{children:e.jsxs(Y,{children:[e.jsx(c,{scope:"col",children:"#"}),e.jsx(c,{scope:"col",children:"Name"}),e.jsx(c,{scope:"col",children:"Category"}),e.jsx(c,{scope:"col",children:"Stop Type"}),e.jsx(c,{scope:"col",children:"Tag Line"}),e.jsx(c,{scope:"col",children:"Description"}),e.jsx(c,{scope:"col",children:"Icon"}),e.jsx(c,{scope:"col",children:"Logo"}),e.jsx(c,{scope:"col",children:"Image"}),e.jsx(c,{scope:"col",children:"Domain Name"}),e.jsx(c,{scope:"col",children:"Status"}),e.jsx(c,{scope:"col",children:"Is Hot Place"}),e.jsx(c,{scope:"col",children:"Latitude"}),e.jsx(c,{scope:"col",children:"Longitude"}),e.jsx(c,{scope:"col",children:"Actions"})]})}),e.jsx(fe,{children:O.map((a,t)=>e.jsxs(Y,{children:[e.jsx(c,{scope:"row",children:t+1}),e.jsx(d,{children:a.name}),e.jsx(d,{children:a.categories&&a.categories.length>0?a.categories.map(s=>e.jsx("span",{style:{marginRight:"5px",display:"inline-block",whiteSpace:"nowrap"},children:" #"+s.name},s.id)):e.jsx("span",{children:"No Categories"})}),e.jsx(d,{children:a.bus_stop_type}),e.jsx(d,{children:a.tag_line}),e.jsx(d,{children:a.description}),e.jsx(d,{children:a.icon?e.jsx(G,{src:"https://ftp.dev.tourkokan.com/"+a.icon,alt:a.icon,width:"50"}):"No Image"})," ",e.jsx(d,{children:a.logo?e.jsx(G,{src:"https://ftp.dev.tourkokan.com/"+a.logo,alt:a.logo,width:"50"}):"No Image"})," ",e.jsx(d,{children:a.image?e.jsx(G,{src:"https://ftp.dev.tourkokan.com/"+a.image,alt:a.image,width:"50"}):"No Image"}),e.jsx(d,{children:a.domain_name}),e.jsx(d,{children:a.status}),e.jsx(d,{children:a.is_hot_place}),e.jsx(d,{children:a.latitude}),e.jsx(d,{children:a.longitude}),e.jsxs(d,{children:[e.jsx(f,{color:"warning",size:"sm",onClick:()=>re(a),children:"Edit"})," ",e.jsx(f,{color:"danger",size:"sm",onClick:()=>le(a.id),children:"Delete"})]})]},a.id))})]}),e.jsx(_e,{children:q.map((a,t)=>e.jsx(ye,{active:a.active,onClick:()=>I(a.label),disabled:!a.url,children:C(a.label)},t))})]})})]})}),e.jsxs(Z,{visible:z,onClose:()=>x(!1),children:[e.jsx(ee,{onClose:()=>x(!1),children:e.jsx(ae,{children:"Add Site"})}),e.jsx(ne,{children:e.jsxs(K,{children:[e.jsx(i,{htmlFor:"name",children:"Name"}),e.jsx(l,{id:"name",name:"name",value:n.name,onChange:o}),e.jsx(i,{htmlFor:"name",children:"Site"}),e.jsx(k,{onChange:E,endpoint:"sites",label:"Cities",filter:[{}]}),e.jsx(i,{htmlFor:"name",children:"Categories"}),e.jsx(ie,{onChange:V,endpoint:"listcategories",label:"Categories",filter:[{global:1}]}),e.jsx(i,{htmlFor:"bus_stop_type",children:"Bus Stop Type"}),e.jsx(l,{id:"bus_stop_type",name:"bus_stop_type",value:n.bus_stop_type,onChange:o}),e.jsx(i,{htmlFor:"tag_line",children:"Tag Line"}),e.jsx(l,{id:"tag_line",name:"tag_line",value:n.tag_line,onChange:o}),e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(l,{id:"description",name:"description",value:n.description,onChange:o}),e.jsx(i,{htmlFor:"domain_name",children:"Domain Name"}),e.jsx(l,{id:"domain_name",name:"domain_name",value:n.domain_name,onChange:o}),e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(te,{id:"status",name:"status",value:n.status,onChange:o,children:[e.jsx("option",{value:!0,children:"Active"}),e.jsx("option",{value:!1,children:"Inactive"})]}),e.jsx(i,{htmlFor:"is_hot_place",children:"Is Hot Place"}),e.jsx(l,{id:"is_hot_place",name:"is_hot_place",value:n.is_hot_place,onChange:o}),e.jsx(i,{htmlFor:"latitude",children:"Latitude"}),e.jsx(l,{id:"latitude",name:"latitude",value:n.latitude,onChange:o}),e.jsx(i,{htmlFor:"longitude",children:"Longitude"}),e.jsx(l,{id:"longitude",name:"longitude",value:n.longitude,onChange:o}),e.jsx(i,{htmlFor:"pin_code",children:"Pin Code"}),e.jsx(l,{id:"pin_code",name:"pin_code",value:n.pin_code,onChange:o}),e.jsx(i,{htmlFor:"speciality",children:"Speciality"}),e.jsx(l,{id:"speciality",name:"speciality",value:n.speciality,onChange:o}),e.jsx(i,{htmlFor:"rules",children:"Rules"}),e.jsx(l,{id:"rules",name:"rules",value:n.rules,onChange:o}),e.jsx(i,{htmlFor:"social_media",children:"Social Media"}),e.jsx(l,{id:"social_media",name:"social_media",value:n.social_media,onChange:o}),e.jsx(i,{htmlFor:"meta_data",children:"Meta Data"}),e.jsx(l,{id:"meta_data",name:"meta_data",value:n.meta_data,onChange:o}),e.jsx(i,{htmlFor:"logo",children:"Logo"}),e.jsx(l,{type:"file",id:"logo",name:"logo",onChange:j}),e.jsx(i,{htmlFor:"icon",children:"Icon"}),e.jsx(l,{type:"file",id:"icon",name:"icon",onChange:j}),e.jsx(i,{htmlFor:"image",children:"Image"}),e.jsx(l,{type:"file",id:"image",name:"image",onChange:j})]})}),e.jsxs(se,{children:[e.jsx(f,{color:"secondary",onClick:()=>x(!1),children:"Close"}),e.jsx(f,{color:"primary",onClick:P,children:"Save changes"})]})]}),e.jsxs(Z,{visible:T,onClose:()=>F(!1),children:[e.jsx(ee,{onClose:()=>F(!1),children:e.jsx(ae,{children:"Add Site"})}),e.jsx(ne,{children:e.jsxs(K,{children:[e.jsx(i,{htmlFor:"name",children:"Name"}),e.jsx(l,{id:"name",name:"name",value:n.name,onChange:o}),e.jsx(i,{htmlFor:"site",children:"Site"}),e.jsx(k,{onChange:E,endpoint:"sites",label:"Cities",filter:[{}]}),e.jsx(i,{htmlFor:"categories",children:"Categories"}),e.jsx(ie,{onChange:V,endpoint:"listcategories",label:"Categories",filter:[{global:1}]}),e.jsx(i,{htmlFor:"bus_stop_type",children:"Bus Stop Type"}),e.jsx(l,{id:"bus_stop_type",name:"bus_stop_type",value:n.bus_stop_type,onChange:o}),e.jsx(i,{htmlFor:"tag_line",children:"Tag Line"}),e.jsx(l,{id:"tag_line",name:"tag_line",value:n.tag_line,onChange:o}),e.jsx(i,{htmlFor:"description",children:"Description"}),e.jsx(l,{id:"description",name:"description",value:n.description,onChange:o}),e.jsx(i,{htmlFor:"domain_name",children:"Domain Name"}),e.jsx(l,{id:"domain_name",name:"domain_name",value:n.domain_name,onChange:o}),e.jsx(i,{htmlFor:"status",children:"Status"}),e.jsxs(te,{id:"status",name:"status",value:n.status,onChange:o,children:[e.jsx("option",{value:!0,children:"Active"}),e.jsx("option",{value:!1,children:"Inactive"})]}),e.jsx(i,{htmlFor:"is_hot_place",children:"Is Hot Place"}),e.jsx(l,{id:"is_hot_place",name:"is_hot_place",value:n.is_hot_place,onChange:o}),e.jsx(i,{htmlFor:"latitude",children:"Latitude"}),e.jsx(l,{id:"latitude",name:"latitude",value:n.latitude,onChange:o}),e.jsx(i,{htmlFor:"longitude",children:"Longitude"}),e.jsx(l,{id:"longitude",name:"longitude",value:n.longitude,onChange:o}),e.jsx(i,{htmlFor:"pin_code",children:"Pin Code"}),e.jsx(l,{id:"pin_code",name:"pin_code",value:n.pin_code,onChange:o}),e.jsx(i,{htmlFor:"speciality",children:"Speciality"}),e.jsx(l,{id:"speciality",name:"speciality",value:n.speciality,onChange:o}),e.jsx(i,{htmlFor:"rules",children:"Rules"}),e.jsx(l,{id:"rules",name:"rules",value:n.rules,onChange:o}),e.jsx(i,{htmlFor:"social_media",children:"Social Media"}),e.jsx(l,{id:"social_media",name:"social_media",value:n.social_media,onChange:o}),e.jsx(i,{htmlFor:"meta_data",children:"Meta Data"}),e.jsx(l,{id:"meta_data",name:"meta_data",value:n.meta_data,onChange:o}),e.jsx(i,{htmlFor:"logo",children:"Logo"}),e.jsx(l,{type:"file",id:"logo",name:"logo",onChange:j}),e.jsx(i,{htmlFor:"icon",children:"Icon"}),e.jsx(l,{type:"file",id:"icon",name:"icon",onChange:j}),e.jsx(i,{htmlFor:"image",children:"Image"}),e.jsx(l,{type:"file",id:"image",name:"image",onChange:j})]})}),e.jsxs(se,{children:[e.jsx(f,{color:"secondary",onClick:()=>F(!1),children:"Close"}),e.jsx(f,{color:"primary",onClick:ce,children:"Save Changes"})]})]})]})};export{ze as default};
